{"version":3,"sources":["img/send.svg","panels/Message.js","services/axios.js","panels/Chat.js","panels/Home.js","panels/LoadingPanel.js","App.js","index.js"],"names":["module","exports","__webpack_require__","p","Message","_ref","myId","_ref$data","data","sender_id","id","text","reciever_id","unixtime","react_default","a","createElement","style","display","width","className","marginLeft","backgroundColor","color","axios","url","fetch","method","headers","Accept","Content-Type","body","JSON","stringify","Object","objectSpread","sign","window","location","search","slice","then","response","status","json","Error","timeout","messagesSaver","chatId","Chat","state","messages","isLoading","writeng","sendButton","React","createRef","mesContentRef","updateScroll","scrollTo","_this","current","scrollHeight","updateMessages","userId","props","send","resp","setState","onClick","e","success","_this2","this","setTimeout","setInterval","length","clearTimeout","_this3","console","log","innerHeight","clientHeight","_this$state","_this$props","back","pavId","es6","centered","left","PanelHeaderBack_default","ref","map","message","panels_Message","key","Fragment","distextAlign","bottom","textAlign","position","right","vertical","padding","placeItems","top","zIndex","flex","background","autocomplete","type","name","placeholder","value","onChange","currentTarget","src","Send","height","align","Component","chatsSaver","Home","chats","updateChats","openChat","_this$props2","chat","i","expandable","user_id","LoadingPanel","App","history","activePanel","go","toConsumableArray","push","connect","pop","schemeAttribute","document","createAttribute","attributes","setNamedItem","setTheme","_this$state2","isWebView","onSwipeBack","panels_LoadingPanel","panels_Home","panels_Chat","ReactDOM","render","src_App","getElementById"],"mappings":"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","file":"static/js/main.6229dca0.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/send.5d4960d5.svg\";","import React from \"react\";\r\n\r\nconst Message = ({\r\n\tmyId,\r\n\tdata: { id, sender_id, reciever_id, unixtime, text }\r\n}) => (\r\n\t<div style={{ display: \"flex\", width: \"100%\" }}>\r\n\t\t<div\r\n\t\t\tclassName=\"Message\"\r\n\t\t\tstyle={\r\n\t\t\t\tsender_id === myId\r\n\t\t\t\t\t? {\r\n\t\t\t\t\t\t\tmarginLeft: \"auto\",\r\n\t\t\t\t\t\t\tbackgroundColor: \"#cfe6ff\",\r\n\t\t\t\t\t\t\tcolor: \"black\"\r\n\t\t\t\t\t  }\r\n\t\t\t\t\t: null\r\n\t\t\t}\r\n\t\t>\r\n\t\t\t{text}\r\n\t\t</div>\r\n\t</div>\r\n);\r\n\r\nexport default Message;\r\n","class axios {\r\n\tstatic send(url, data) {\r\n\t\treturn fetch(\"https://ipagar.ddns.net:8082\" + url, {\r\n\t\t\tmethod: \"POST\",\r\n\t\t\theaders: {\r\n\t\t\t\tAccept: \"application/json\",\r\n\t\t\t\t\"Content-Type\": \"application/json\"\r\n\t\t\t},\r\n\t\t\tbody: JSON.stringify({\r\n\t\t\t\t...data,\r\n\t\t\t\tsign: window.location.search.slice(1)\r\n\t\t\t})\r\n\t\t}).then(response => {\r\n\t\t\tif (response.status === 200) return response.json();\r\n\t\t\telse throw new Error(response.status);\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport default axios;\r\n","import React from \"react\";\r\nimport { Panel, PanelHeader, Div, FixedLayout } from \"@vkontakte/vkui\";\r\nimport PanelHeaderBack from \"@vkontakte/vkui/dist/components/PanelHeaderBack/PanelHeaderBack\";\r\nimport Send from \"../img/send.svg\";\r\nimport Message from \"./Message\";\r\nimport axios from \"../services/axios\";\r\n\r\nlet timeout = null;\r\nlet messagesSaver = [];\r\nlet chatId = null;\r\nlet timeoutScroll = null;\r\n\r\nclass Chat extends React.Component {\r\n\tstate = {\r\n\t\tmessages: [],\r\n\t\tisLoading: true,\r\n\t\twriteng: \"\"\r\n\t};\r\n\tsendButton = React.createRef();\r\n\tmesContentRef = React.createRef();\r\n\r\n\tcomponentDidMount() {\r\n\t\tconst { userId } = this.props;\r\n\r\n\t\tif (chatId === userId) this.setState({ messages: messagesSaver });\r\n\t\tthis.updateMessages().then(() => {\r\n\t\t\tsetTimeout(this.updateScroll, 1000);\r\n\t\t});\r\n\r\n\t\ttimeout = setInterval(this.updateMessages, 1000);\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tconst { messages } = this.state;\r\n\t\tconst { userId } = this.props;\r\n\r\n\t\tif (messages.length > 0) {\r\n\t\t\tmessagesSaver = messages;\r\n\t\t\tchatId = userId;\r\n\t\t}\r\n\r\n\t\tclearTimeout(timeout);\r\n\t}\r\n\r\n\tupdateScroll = () => {\r\n\t\twindow.scrollTo(0, this.mesContentRef.current.scrollHeight);\r\n\t};\r\n\r\n\tupdateMessages = () => {\r\n\t\tconst { userId } = this.props;\r\n\r\n\t\treturn axios.send(\"/messages\", { reciever_id: userId }).then(resp => {\r\n\t\t\tthis.setState({ messages: resp, isLoading: false });\r\n\t\t});\r\n\t};\r\n\r\n\tonClick = e => {\r\n\t\tconst { writeng } = this.state;\r\n\t\tconst { userId } = this.props;\r\n\r\n\t\taxios\r\n\t\t\t.send(\"/message\", {\r\n\t\t\t\treciever_id: userId,\r\n\t\t\t\ttext: writeng\r\n\t\t\t})\r\n\t\t\t.then(success => {\r\n\t\t\t\tthis.updateMessages().then(() => {\r\n\t\t\t\t\tthis.setState({ writeng: \"\" });\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t};\r\n\r\n\trender() {\r\n\t\tconsole.log(\r\n\t\t\twindow.innerHeight,\r\n\t\t\tthis.mesContentRef.current\r\n\t\t\t\t? this.mesContentRef.current.clientHeight\r\n\t\t\t\t: null\r\n\t\t);\r\n\t\tconst { writeng, messages, isLoading } = this.state;\r\n\t\tconst { myId, back, pavId } = this.props;\r\n\r\n\t\treturn (\r\n\t\t\t<Panel\r\n\t\t\t\tid=\"chat\"\r\n\t\t\t\tcentered={messages.length > 0 || !isLoading ? false : true}\r\n\t\t\t>\r\n\t\t\t\t<PanelHeader\r\n\t\t\t\t\tleft={\r\n\t\t\t\t\t\tmyId === pavId ? (\r\n\t\t\t\t\t\t\t<PanelHeaderBack\r\n\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\tback();\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t) : null\r\n\t\t\t\t\t}\r\n\t\t\t\t>\r\n\t\t\t\t\t{!isLoading ? \"В чатике\" : \"Загрузочка...\"}\r\n\t\t\t\t</PanelHeader>\r\n\t\t\t\t{messages.length > 0 || !isLoading ? (\r\n\t\t\t\t\t<div className={\"MessagesContent\"} ref={this.mesContentRef}>\r\n\t\t\t\t\t\t{messages.map(message => (\r\n\t\t\t\t\t\t\t<Message\r\n\t\t\t\t\t\t\t\tkey={message.id}\r\n\t\t\t\t\t\t\t\tdata={message}\r\n\t\t\t\t\t\t\t\tmyId={myId}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t))}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<React.Fragment>\r\n\t\t\t\t\t\t<Div\r\n\t\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\t\tdistextAlign: \"center\",\r\n\t\t\t\t\t\t\t\tbottom: 0,\r\n\t\t\t\t\t\t\t\ttextAlign: \"center\"\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<h1>\r\n\t\t\t\t\t\t\t\t<b>Это анонимно</b>\r\n\t\t\t\t\t\t\t</h1>\r\n\t\t\t\t\t\t\t<br />\r\n\t\t\t\t\t\t\tПавел не узнает, кто является его собеседником.\r\n\t\t\t\t\t\t</Div>\r\n\t\t\t\t\t\t<Div\r\n\t\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\t\tposition: \"absolute\",\r\n\t\t\t\t\t\t\t\tbottom: 0,\r\n\t\t\t\t\t\t\t\tleft: 0,\r\n\t\t\t\t\t\t\t\tright: 0\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</React.Fragment>\r\n\t\t\t\t)}\r\n\t\t\t\t<FixedLayout vertical=\"bottom\">\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\tpadding: 5,\r\n\t\t\t\t\t\t\tdisplay: \"flex\",\r\n\t\t\t\t\t\t\tplaceItems: \"center\"\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tid=\"background\"\r\n\t\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\t\tposition: \"absolute\",\r\n\t\t\t\t\t\t\t\ttop: 0,\r\n\t\t\t\t\t\t\t\tleft: 0,\r\n\t\t\t\t\t\t\t\tright: 0,\r\n\t\t\t\t\t\t\t\tbottom: 0,\r\n\t\t\t\t\t\t\t\tbackgroundColor: \"#f5f5f5\",\r\n\t\t\t\t\t\t\t\tzIndex: -1\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\tref={this.sendButton}\r\n\t\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\t\tflex: 1,\r\n\t\t\t\t\t\t\t\tbackground: \"var(--background_light)\"\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\tautocomplete=\"off\"\r\n\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\tname=\"writeng\"\r\n\t\t\t\t\t\t\tplaceholder=\"Сообщение...\"\r\n\t\t\t\t\t\t\tvalue={writeng}\r\n\t\t\t\t\t\t\tonChange={e => {\r\n\t\t\t\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\t\t\t\twriteng: e.currentTarget.value\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\tonClick={this.onClick}\r\n\t\t\t\t\t\t\tsrc={Send}\r\n\t\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\t\theight: \"44px\",\r\n\t\t\t\t\t\t\t\talign: \"center\"\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</FixedLayout>\r\n\t\t\t</Panel>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default Chat;\r\n","import React from \"react\";\r\nimport { Panel, PanelHeader, Div, Button, Cell, List } from \"@vkontakte/vkui\";\r\nimport axios from \"../services/axios\";\r\n\r\nlet timeout = null;\r\nlet chatsSaver = [];\r\n\r\nclass Home extends React.Component {\r\n\tstate = { chats: [] };\r\n\r\n\tcomponentDidMount() {\r\n\t\tconst { myId, pavId, openChat } = this.props;\r\n\t\tthis.setState({ chats: chatsSaver });\r\n\r\n\t\tthis.updateChats();\r\n\t\ttimeout = setInterval(this.updateChats, 10000);\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tconst { chats } = this.state;\r\n\t\tchatsSaver = chats;\r\n\r\n\t\tclearTimeout(timeout);\r\n\t}\r\n\r\n\tupdateChats = () => {\r\n\t\taxios.send(\"/chats\").then(resp => {\r\n\t\t\tthis.setState({ chats: resp });\r\n\t\t});\r\n\t};\r\n\r\n\trender() {\r\n\t\tconst { chats } = this.state;\r\n\t\tconst { myId, pavId } = this.props;\r\n\t\tconst { openChat } = this.props;\r\n\r\n\t\treturn (\r\n\t\t\t<Panel id=\"home\" centered={myId === pavId ? false : true}>\r\n\t\t\t\t<PanelHeader>\r\n\t\t\t\t\t{myId === pavId ? \"Чатики\" : \"Здравствуйте!\"}\r\n\t\t\t\t</PanelHeader>\r\n\r\n\t\t\t\t{chats.length > 0 ? (\r\n\t\t\t\t\t<List>\r\n\t\t\t\t\t\t{chats.map((chat, i) => (\r\n\t\t\t\t\t\t\t<Cell\r\n\t\t\t\t\t\t\t\texpandable\r\n\t\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\t\topenChat(chat.user_id);\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tСобеседник #{i + 1}\r\n\t\t\t\t\t\t\t</Cell>\r\n\t\t\t\t\t\t))}\r\n\t\t\t\t\t</List>\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<Div style={{ textAlign: \"center\" }}>\r\n\t\t\t\t\t\tПока никто не написал :(\r\n\t\t\t\t\t</Div>\r\n\t\t\t\t)}\r\n\t\t\t</Panel>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default Home;\r\n","import React from \"react\";\r\nimport { Panel, PanelHeader, PanelSpinner } from \"@vkontakte/vkui\";\r\n\r\nclass LoadingPanel extends React.Component {\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<Panel id=\"loadingPanel\" centered>\r\n\t\t\t\t<PanelHeader>Загрузочка...</PanelHeader>\r\n\t\t\t\t<PanelSpinner />\r\n\t\t\t</Panel>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport default LoadingPanel;\r\n","import React from \"react\";\nimport connect from \"@vkontakte/vkui-connect-promise\";\nimport { View, ConfigProvider } from \"@vkontakte/vkui\";\nimport \"@vkontakte/vkui/dist/vkui.css\";\nimport \"./app.css\";\nimport Chat from \"./panels/Chat\";\nimport Home from \"./panels/Home\";\nimport LoadingPanel from \"./panels/LoadingPanel\";\n\nclass App extends React.Component {\n\tstate = {\n\t\thistory: [],\n\t\tactivePanel: \"loadingPanel\",\n\t\tuserId: null,\n\t\tmyId: null,\n\t\tpavId: 67602787\n\t};\n\n\tsetTheme() {\n\t\tlet schemeAttribute = document.createAttribute(\"scheme\");\n\t\tschemeAttribute.value = \"bright_light\";\n\t\tdocument.body.attributes.setNamedItem(schemeAttribute);\n\t}\n\n\tcomponentDidMount() {\n\t\tconst { myId, pavId, openChat } = this.state;\n\n\t\tthis.setTheme();\n\t\tconnect.send(\"VKWebAppGetUserInfo\", {}).then(success => {\n\t\t\tthis.setState({ myId: success.data.id });\n\t\t\tif (success.data.id === pavId) {\n\t\t\t\tthis.go(\"home\");\n\t\t\t} else {\n\t\t\t\tthis.openChat(pavId);\n\t\t\t}\n\t\t});\n\t}\n\n\topenChat = user_id => {\n\t\tthis.setState({ userId: user_id });\n\t\tthis.go(\"chat\");\n\t};\n\n\tgo = activePanel => {\n\t\tconst history = [...this.state.history];\n\t\thistory.push(activePanel);\n\t\tif (this.state.activePanel === \"home\") {\n\t\t\tconnect.send(\"VKWebAppEnableSwipeBack\");\n\t\t}\n\t\tthis.setState({ history, activePanel });\n\t};\n\n\tback = () => {\n\t\tconst history = [...this.state.history];\n\t\thistory.pop();\n\t\tconst activePanel = history[history.length - 1];\n\t\tif (activePanel === \"home\") {\n\t\t\tconnect.send(\"VKWebAppDisableSwipeBack\");\n\t\t}\n\t\tthis.setState({ history, activePanel });\n\t};\n\n\trender() {\n\t\tconst { myId, pavId, userId } = this.state;\n\n\t\treturn (\n\t\t\t<ConfigProvider isWebView={true}>\n\t\t\t\t<View\n\t\t\t\t\tonSwipeBack={this.back}\n\t\t\t\t\thistory={this.state.history}\n\t\t\t\t\tactivePanel={this.state.activePanel}\n\t\t\t\t>\n\t\t\t\t\t<LoadingPanel id=\"loadingPanel\" />\n\t\t\t\t\t<Home\n\t\t\t\t\t\tid=\"home\"\n\t\t\t\t\t\tmyId={myId}\n\t\t\t\t\t\tpavId={pavId}\n\t\t\t\t\t\topenChat={this.openChat}\n\t\t\t\t\t/>\n\t\t\t\t\t<Chat\n\t\t\t\t\t\tid=\"chat\"\n\t\t\t\t\t\tmyId={myId}\n\t\t\t\t\t\tpavId={pavId}\n\t\t\t\t\t\tback={this.back}\n\t\t\t\t\t\tuserId={userId}\n\t\t\t\t\t/>\n\t\t\t\t</View>\n\t\t\t</ConfigProvider>\n\t\t);\n\t}\n}\n\nexport default App;\n","import \"core-js/features/map\";\nimport \"core-js/features/set\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport connect from \"@vkontakte/vkui-connect-promise\";\nimport App from \"./App\";\n\nconnect.send(\"VKWebAppInit\", {});\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}